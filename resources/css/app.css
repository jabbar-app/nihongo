@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  /* Japanese text styling - updated to match design system */
  .font-japanese {
    font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
  }

  /* Speaking-focused button styles */
  .btn-speaking {
    @apply bg-gradient-to-br from-brand-primary to-brand-secondary text-white font-semibold px-6 py-3 rounded-lg shadow-audio transition-all duration-200;
  }

  .btn-speaking:hover {
    @apply transform -translate-y-0.5 shadow-card-hover;
  }

  .btn-speaking:active {
    @apply transform translate-y-0;
  }

  /* Audio control button styles */
  .btn-audio {
    @apply w-14 h-14 rounded-full bg-brand-primary text-white flex items-center justify-center shadow-audio transition-all duration-200;
  }

  .btn-audio:hover {
    @apply bg-brand-secondary transform scale-105;
  }

  .btn-audio.recording {
    @apply bg-audio-recording animate-pulse;
  }

  .btn-audio.playing {
    @apply bg-audio-playing;
  }

  /* Conversation card styles */
  .card-conversation {
    @apply bg-white border border-gray-200 rounded-card p-6 transition-all duration-300;
  }

  .card-conversation:hover {
    @apply shadow-card-hover transform -translate-y-1;
  }

  .card-conversation.locked {
    @apply opacity-60 cursor-not-allowed;
  }

  .card-conversation.in-progress {
    @apply border-2 border-brand-primary;
  }

  .card-conversation.completed {
    @apply border-2 border-matcha-400 bg-matcha-50;
  }

  /* Speaking progress indicators */
  .progress-speaking {
    @apply h-2 bg-gradient-to-r from-brand-primary to-brand-secondary rounded-full transition-all duration-700;
  }

  /* Streak indicator with glow */
  .streak-indicator {
    @apply inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-50 to-red-50 border-2 border-sunset-orange rounded-lg animate-glow;
  }

  /* Audio waveform visualization */
  .audio-wave {
    @apply inline-block w-1 h-8 bg-audio-wave rounded-full animate-wave;
  }

  .audio-wave:nth-child(2) {
    animation-delay: 0.1s;
  }

  .audio-wave:nth-child(3) {
    animation-delay: 0.2s;
  }

  .audio-wave:nth-child(4) {
    animation-delay: 0.3s;
  }

  .audio-wave:nth-child(5) {
    animation-delay: 0.4s;
  }

  /* Enhanced Audio Player Styles */
  .audio-player-full {
    @apply transition-all duration-300;
  }

  .audio-player-compact {
    @apply transition-all duration-300;
  }

  /* Custom range input styling for audio progress */
  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #4F46E5;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease-in-out;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 8px rgba(79, 70, 229, 0.4);
  }

  input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #4F46E5;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease-in-out;
  }

  input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 8px rgba(79, 70, 229, 0.4);
  }

  input[type="range"]:focus {
    outline: none;
  }

  input[type="range"]:focus::-webkit-slider-thumb {
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
  }

  input[type="range"]:focus::-moz-range-thumb {
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
  }

  /* Japanese text display with proper sizing */
  .text-japanese-display {
    @apply text-japanese-2xl font-japanese leading-relaxed;
  }

  .text-japanese-body {
    @apply text-japanese-lg font-japanese leading-relaxed;
  }

  /* Romaji text styling */
  .text-romaji {
    @apply text-sm text-gray-500 font-mono;
  }

  /* Speaking level badge */
  .badge-level {
    @apply inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-gradient-to-r from-brand-primary to-brand-secondary text-white;
  }

  /* Achievement badge */
  .badge-achievement {
    @apply inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-sakura-100 to-sakura-200 text-sakura-500 font-semibold border-2 border-sakura-300;
  }

  /* Celebration modal overlay */
  .modal-celebration {
    @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in;
  }

  .modal-celebration-content {
    @apply bg-white rounded-2xl p-8 max-w-md w-full mx-4 animate-bounce-subtle;
  }

  /* Touch-friendly mobile controls */
  .touch-target {
    @apply min-h-[44px] min-w-[44px] flex items-center justify-center;
  }

  /* Gradient backgrounds for sections */
  .bg-speaking-gradient {
    @apply bg-gradient-to-br from-indigo-50 via-white to-sakura-50;
  }

  .bg-success-gradient {
    @apply bg-gradient-to-br from-matcha-50 to-matcha-100;
  }

  /* XP gain animation */
  .xp-gain {
    @apply inline-block text-brand-primary font-bold animate-slide-up;
  }

  /* Smooth page transitions */
  .page-transition {
    @apply transition-opacity duration-300 ease-in-out;
  }

  /* Progress bar animations */
  .progress-bar {
    @apply transition-all duration-700 ease-out;
    animation: progressGrow 0.7s ease-out;
  }

  @keyframes progressGrow {
    from {
      transform: scaleX(0);
      transform-origin: left;
    }
    to {
      transform: scaleX(1);
    }
  }

  /* Loading spinner */
  .spinner {
    @apply inline-block w-8 h-8 border-4 border-gray-200 border-t-blue-600 rounded-full;
    animation: spin 1s linear infinite;
  }

  .spinner-sm {
    @apply inline-block w-4 h-4 border-2 border-gray-200 border-t-blue-600 rounded-full;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Pulse animation for loading states */
  .pulse-slow {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Hover effects for interactive elements */
  .hover-lift {
    @apply transition-all duration-200 ease-in-out;
  }

  .hover-lift:hover {
    @apply transform -translate-y-1 shadow-lg;
  }

  .hover-scale {
    @apply transition-transform duration-200 ease-in-out;
  }

  .hover-scale:hover {
    @apply transform scale-105;
  }

  /* Card hover effects */
  .card-hover {
    @apply transition-all duration-300 ease-in-out;
  }

  .card-hover:hover {
    @apply shadow-xl transform -translate-y-1;
  }

  /* Button press effect */
  .btn-press:active {
    @apply transform scale-95;
  }

  /* Fade in animation */
  .fade-in {
    animation: fadeIn 0.5s ease-in;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Slide in from bottom */
  .slide-in-bottom {
    animation: slideInBottom 0.4s ease-out;
  }

  @keyframes slideInBottom {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Slide in from top */
  .slide-in-top {
    animation: slideInTop 0.4s ease-out;
  }

  @keyframes slideInTop {
    from {
      transform: translateY(-20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Bounce animation for achievements */
  .bounce-in {
    animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  @keyframes bounceIn {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    50% {
      transform: scale(1.1);
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Shake animation for errors */
  .shake {
    animation: shake 0.5s;
  }

  @keyframes shake {
    0%, 100% {
      transform: translateX(0);
    }
    10%, 30%, 50%, 70%, 90% {
      transform: translateX(-5px);
    }
    20%, 40%, 60%, 80% {
      transform: translateX(5px);
    }
  }

  /* Glow effect for special elements */
  .glow {
    animation: glow 2s ease-in-out infinite;
  }

  @keyframes glow {
    0%, 100% {
      box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
    }
    50% {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
    }
  }

  /* Celebration animation */
  .celebrate {
    animation: celebrate 0.8s ease-in-out;
  }

  @keyframes celebrate {
    0%, 100% {
      transform: scale(1) rotate(0deg);
    }
    25% {
      transform: scale(1.1) rotate(-5deg);
    }
    75% {
      transform: scale(1.1) rotate(5deg);
    }
  }
}

@layer utilities {
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  /* Improve touch interactions on mobile */
  .touch-manipulation {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Safe area utilities for mobile devices */
  .pb-safe {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .pt-safe {
    padding-top: env(safe-area-inset-top);
  }

  .mb-safe {
    margin-bottom: env(safe-area-inset-bottom);
  }

  .mt-safe {
    margin-top: env(safe-area-inset-top);
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Text gradient utilities for speaking emphasis */
  .text-gradient-speaking {
    background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .text-gradient-success {
    background: linear-gradient(135deg, #88B04B 0%, #6B8E23 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Audio playback state indicators */
  .audio-playing::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: #22C55E;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 1.5s infinite;
  }

  .audio-paused::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: #94A3B8;
    border-radius: 50%;
    margin-right: 8px;
  }

  /* Sticky audio controls for mobile */
  .sticky-audio {
    position: sticky;
    bottom: 0;
    z-index: 40;
    backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.95);
  }

  /* Mobile audio player optimizations */
  .audio-player-mini {
    @apply transition-all duration-300;
  }

  @media (max-width: 768px) {
    .audio-player-mini {
      @apply pb-safe;
    }
  }

  /* Floating audio player for mobile */
  .audio-player-floating {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.98);
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1), 0 -2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  @media (max-width: 768px) {
    .audio-player-floating {
      padding-bottom: env(safe-area-inset-bottom);
    }
  }

  /* Speaking focus ring */
  .focus-speaking:focus-visible {
    outline: 2px solid #4F46E5;
    outline-offset: 2px;
  }
}

/* Alpine.js x-cloak directive */
[x-cloak] {
  display: none !important;
}

/* Enhanced Focus Indicators for Keyboard Navigation */
@layer base {
  /* Default focus styles for all interactive elements */
  a:focus-visible,
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible,
  [tabindex]:focus-visible {
    outline: 2px solid theme('colors.indigo.500');
    outline-offset: 2px;
    border-radius: 0.25rem;
  }

  /* Remove default outline and use custom ring */
  *:focus {
    outline: none;
  }

  /* Enhanced focus for buttons */
  button:focus-visible {
    @apply ring-2 ring-indigo-500 ring-offset-2;
  }

  /* Enhanced focus for links */
  a:focus-visible {
    @apply ring-2 ring-indigo-500 ring-offset-2;
  }

  /* Enhanced focus for form inputs */
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    @apply ring-2 ring-indigo-500 border-indigo-500;
  }

  /* Skip to main content link (for screen readers) */
  .skip-to-main {
    position: absolute;
    left: -9999px;
    z-index: 999;
    padding: 1rem;
    background-color: theme('colors.indigo.600');
    color: white;
    text-decoration: none;
  }

  .skip-to-main:focus {
    left: 50%;
    transform: translateX(-50%);
    top: 1rem;
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Screen reader only content that becomes visible on focus */
  .sr-only-focusable:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

/* Keyboard shortcut badge styles */
@layer components {
  .kbd {
    @apply inline-block px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-300 rounded shadow-sm;
  }
}

/* Mobile-Specific Optimizations */
@layer utilities {
  /* Mobile font size optimizations - minimum 16px for body text */
  @media (max-width: 640px) {
    body {
      font-size: 16px;
    }

    /* Ensure all text inputs are at least 16px to prevent zoom on iOS */
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="search"],
    input[type="tel"],
    input[type="url"],
    textarea,
    select {
      font-size: 16px !important;
    }

    /* Larger headings on mobile for better readability */
    h1 {
      font-size: 2rem; /* 32px */
    }

    h2 {
      font-size: 1.5rem; /* 24px */
    }

    h3 {
      font-size: 1.25rem; /* 20px */
    }

    /* Ensure all touch targets are minimum 44x44px */
    button,
    a,
    input[type="button"],
    input[type="submit"],
    input[type="reset"],
    .touch-target {
      min-height: 44px;
      min-width: 44px;
    }

    /* Stack layouts vertically on mobile */
    .mobile-stack {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Optimize spacing for smaller screens */
    .mobile-spacing {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    /* Reduce section spacing on mobile */
    .section-spacing {
      padding-top: 2rem;
      padding-bottom: 2rem;
    }

    /* Full-width buttons on mobile */
    .mobile-full-width {
      width: 100%;
    }

    /* Larger tap targets for audio controls */
    .btn-audio {
      width: 56px;
      height: 56px;
    }

    /* Optimize card padding for mobile */
    .card-conversation {
      padding: 1rem;
    }

    /* Reduce font size for metadata on mobile */
    .text-metadata {
      font-size: 0.875rem; /* 14px */
    }

    /* Optimize Japanese text sizing for mobile */
    .text-japanese-display {
      font-size: 1.5rem; /* 24px */
    }

    .text-japanese-body {
      font-size: 1.125rem; /* 18px */
    }

    /* Mobile-optimized navigation spacing */
    .mobile-nav-spacing {
      padding-bottom: calc(64px + env(safe-area-inset-bottom));
    }

    /* Sticky elements should account for mobile nav */
    .sticky-mobile {
      bottom: calc(64px + env(safe-area-inset-bottom));
    }
  }

  /* Tablet-specific optimizations */
  @media (min-width: 641px) and (max-width: 1023px) {
    /* 2-column grid for tablets */
    .tablet-grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }

    /* Optimize touch targets for tablets */
    button,
    a,
    .touch-target {
      min-height: 44px;
      min-width: 44px;
    }
  }

  /* Desktop optimizations */
  @media (min-width: 1024px) {
    /* 3-column grid for desktop */
    .desktop-grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }

    /* Hover effects only on desktop */
    .desktop-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
  }

  /* Responsive text utilities */
  .text-responsive-sm {
    font-size: 0.875rem; /* 14px */
  }

  @media (min-width: 640px) {
    .text-responsive-sm {
      font-size: 1rem; /* 16px */
    }
  }

  .text-responsive-base {
    font-size: 1rem; /* 16px */
  }

  @media (min-width: 640px) {
    .text-responsive-base {
      font-size: 1.125rem; /* 18px */
    }
  }

  .text-responsive-lg {
    font-size: 1.125rem; /* 18px */
  }

  @media (min-width: 640px) {
    .text-responsive-lg {
      font-size: 1.25rem; /* 20px */
    }
  }

  .text-responsive-xl {
    font-size: 1.25rem; /* 20px */
  }

  @media (min-width: 640px) {
    .text-responsive-xl {
      font-size: 1.5rem; /* 24px */
    }
  }

  .text-responsive-2xl {
    font-size: 1.5rem; /* 24px */
  }

  @media (min-width: 640px) {
    .text-responsive-2xl {
      font-size: 2rem; /* 32px */
    }
  }

  /* Mobile-friendly spacing utilities */
  .spacing-mobile-sm {
    padding: 0.5rem;
  }

  @media (min-width: 640px) {
    .spacing-mobile-sm {
      padding: 1rem;
    }
  }

  .spacing-mobile-md {
    padding: 1rem;
  }

  @media (min-width: 640px) {
    .spacing-mobile-md {
      padding: 1.5rem;
    }
  }

  .spacing-mobile-lg {
    padding: 1.5rem;
  }

  @media (min-width: 640px) {
    .spacing-mobile-lg {
      padding: 2rem;
    }
  }

  /* Gap utilities for mobile */
  .gap-mobile-sm {
    gap: 0.5rem;
  }

  @media (min-width: 640px) {
    .gap-mobile-sm {
      gap: 1rem;
    }
  }

  .gap-mobile-md {
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .gap-mobile-md {
      gap: 1.5rem;
    }
  }

  .gap-mobile-lg {
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .gap-mobile-lg {
      gap: 2rem;
    }
  }
}
